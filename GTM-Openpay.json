{
    "exportFormatVersion": 2,
    "exportTime": "2020-01-21 17:34:11",
    "containerVersion": {
        "path": "accounts/4702907809/containers/13043242/versions/43",
        "accountId": "4702907809",
        "containerId": "13043242",
        "containerVersionId": "43",
        "name": "Openpay VTEX GTM",
        "container": {
            "path": "accounts/4702907809/containers/13043242",
            "accountId": "4702907809",
            "containerId": "13043242",
            "name": "openpay vtex",
            "publicId": "GTM-592LR4K",
            "usageContext": [
                "WEB"
            ],
            "fingerprint": "1579627630514",
            "tagManagerUrl": "https://tagmanager.google.com/#/container/accounts/4702907809/containers/13043242/workspaces?apiLink=container"
        },
        "tag": [
            {
                "accountId": "4702907809",
                "containerId": "13043242",
                "tagId": "2",
                "name": "Openpay-DeviceSessionId",
                "type": "html",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "html",
                        "value": "<script src=\"https://openpay.s3.amazonaws.com/openpay.v1.min.js\"></script>\n<script src=\"https://openpay.s3.amazonaws.com/openpay-data.v1.min.js\"></script>\n<script>\n\n$(document).ready(function() {\n      vtexjs.checkout.getOrderForm().done(function(orderForm){\n      OpenPay.setId('{{openpay_merchant_id}}');\n      OpenPay.setApiKey('{{openpay_public_key}}');\n      OpenPay.setSandboxMode({{openpay_sandbox_mode}});\n      var deviceSessionIdOpenPay = OpenPay.deviceData.setup();\n      console.log('deviceSessionIdOpenPay', deviceSessionIdOpenPay);\n      window.vtex.deviceFingerprint = deviceSessionIdOpenPay;\n\t});\n});\n</script>"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "supportDocumentWrite",
                        "value": "false"
                    }
                ],
                "fingerprint": "1579627018892",
                "firingTriggerId": [
                    "5"
                ],
                "tagFiringOption": "ONCE_PER_EVENT",
                "monitoringMetadata": {
                    "type": "MAP"
                }
            },
            {
                "accountId": "4702907809",
                "containerId": "13043242",
                "tagId": "3",
                "name": "Openpay-PaymentReference",
                "type": "html",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "html",
                        "value": "<script>\n$(document).ready(function(){\n  var merchantId ='{{openpay_merchant_id}}';\n  var isSandbox = 'true' === '{{openpay_sandbox_mode}}';\n  var orderId = window.location.search.replace('?og=', '');\n  $.get('/api/checkout/pub/orders/order-group/' + orderId, function(data, status){\n    if (data.length>0 && data[0].paymentData.transactions.length > 0 && data[0].paymentData.transactions[0].payments.length > 0) {\n      var pago = data[0].paymentData.transactions[0].payments[0];\n      var tipoPago = pago.paymentSystemName;\n      var orderData = pago.connectorResponses;\n      var tid= orderData.Tid;\n      var nsu= orderData.nsu;\n      var isSpei = 'SPEI' === tipoPago;\n      if (tid == nsu){\n        console.log('Openpay no reference url');\n        return;\n      }\n\n      console.log('Openpay isSandbox: ' + isSandbox);\n      console.log('Openpay payment tid: ' + tid);\n      console.log('Openpay payment nsu: ' + nsu);\n      console.log('Openpay payment isSpei: ' + isSpei);\n\n      var host = 'https://dashboard.openpay.mx';\n      if (isSandbox) {\n        host = 'https://sandbox-dashboard.openpay.mx';\n      }\n\n      var url = host + '/paynet-pdf/' + merchantId + '/' + tid;\n      if (isSpei) {\n        url = host + '/spei-pdf/' + merchantId + '/' + nsu;\n      }\n      console.log('Url referenceOpenPay: ' + url);\n      var buttonTag = \"Imprimir PDF de \" + tipoPago;\n      $('#checkout-confirmation-top').append('<div class=\"openpay-referencia\" style=\"padding: 10px 20px;margin-top: 10px;background: white;display: inline-block;border-radius:5px;cursor: pointer;box-shadow: 0 1px 3px 0 rgba(0,0,0,.25);\"><a style=\"text-decoration: none;color: #137752;\" href=\"'+ url + '\" target=\"_blank\">'+buttonTag+'</a></div>');\n    }\n  }\n  );\n}\n);\n</script>"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "supportDocumentWrite",
                        "value": "true"
                    }
                ],
                "fingerprint": "1579627734719",
                "firingTriggerId": [
                    "7"
                ],
                "tagFiringOption": "ONCE_PER_EVENT",
                "monitoringMetadata": {
                    "type": "MAP"
                }
            }
        ],
        "trigger": [
            {
                "accountId": "4702907809",
                "containerId": "13043242",
                "triggerId": "5",
                "name": "Openpay-DeviceSessionId",
                "type": "CUSTOM_EVENT",
                "customEventFilter": [
                    {
                        "type": "EQUALS",
                        "parameter": [
                            {
                                "type": "TEMPLATE",
                                "key": "arg0",
                                "value": "{{_event}}"
                            },
                            {
                                "type": "TEMPLATE",
                                "key": "arg1",
                                "value": ".*"
                            }
                        ]
                    }
                ],
                "filter": [
                    {
                        "type": "CONTAINS",
                        "parameter": [
                            {
                                "type": "TEMPLATE",
                                "key": "arg0",
                                "value": "{{Event}}"
                            },
                            {
                                "type": "TEMPLATE",
                                "key": "arg1",
                                "value": "payment"
                            }
                        ]
                    }
                ],
                "fingerprint": "1579626872771"
            },
            {
                "accountId": "4702907809",
                "containerId": "13043242",
                "triggerId": "7",
                "name": "Vtex-Event.GA_Event_orderplaced",
                "type": "CUSTOM_EVENT",
                "customEventFilter": [
                    {
                        "type": "MATCH_REGEX",
                        "parameter": [
                            {
                                "type": "TEMPLATE",
                                "key": "arg0",
                                "value": "{{_event}}"
                            },
                            {
                                "type": "TEMPLATE",
                                "key": "arg1",
                                "value": ".*"
                            }
                        ]
                    }
                ],
                "filter": [
                    {
                        "type": "CONTAINS",
                        "parameter": [
                            {
                                "type": "TEMPLATE",
                                "key": "arg0",
                                "value": "{{Event}}"
                            },
                            {
                                "type": "TEMPLATE",
                                "key": "arg1",
                                "value": "orderPlaced"
                            }
                        ]
                    }
                ],
                "fingerprint": "1569879701545"
            }
        ],
        "variable": [
            {
                "accountId": "4702907809",
                "containerId": "13043242",
                "variableId": "1",
                "name": "openpay_merchant_id",
                "type": "c",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "value",
                        "value": "mxxxxxxxxxxxxxxxxxxx"
                    }
                ],
                "fingerprint": "1579626914624",
                "formatValue": {}
            },
            {
                "accountId": "4702907809",
                "containerId": "13043242",
                "variableId": "4",
                "name": "openpay_public_key",
                "type": "c",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "value",
                        "value": "pk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
                    }
                ],
                "fingerprint": "1579626969746",
                "formatValue": {}
            },
            {
                "accountId": "4702907809",
                "containerId": "13043242",
                "variableId": "5",
                "name": "openpay_sandbox_mode",
                "type": "c",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "value",
                        "value": "true"
                    }
                ],
                "fingerprint": "1579626954666",
                "formatValue": {}
            }
        ],
        "builtInVariable": [
            {
                "accountId": "4702907809",
                "containerId": "13043242",
                "type": "PAGE_URL",
                "name": "Page URL"
            },
            {
                "accountId": "4702907809",
                "containerId": "13043242",
                "type": "PAGE_HOSTNAME",
                "name": "Page Hostname"
            },
            {
                "accountId": "4702907809",
                "containerId": "13043242",
                "type": "PAGE_PATH",
                "name": "Page Path"
            },
            {
                "accountId": "4702907809",
                "containerId": "13043242",
                "type": "REFERRER",
                "name": "Referrer"
            },
            {
                "accountId": "4702907809",
                "containerId": "13043242",
                "type": "EVENT",
                "name": "Event"
            },
            {
                "accountId": "4702907809",
                "containerId": "13043242",
                "type": "CONTAINER_VERSION",
                "name": "Container Version"
            }
        ],
        "fingerprint": "1579627756949",
        "tagManagerUrl": "https://tagmanager.google.com/#/versions/accounts/4702907809/containers/13043242/versions/43?apiLink=version"
    }
}
